<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">










<html>
  <head>
    <title>Groovy Sandbox - </title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/1024px.css");
      @import url("./css/site.css");
    </style>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      </head>
  <body>
    <div id="wrap2"><div id="wrap">
    <div id="header">
      <p id="toplinks">Skip to: <a href="#content">Content</a> | <a href="#sidebar">Navigation</a> | <a href="#footer">Footer</a></p>
		
            <h1 id="bannerLeft">
          <a href="http://groovy-sandbox.kohsuke.org/">
    
            Groovy Sandbox
    
            </a>
        </h1>
                
      <p id="slogan">Executes untrusted Groovy script safely</p>
    </div>
    <div id="breadcrumbs">
      <div class="xright">  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>

    <div id="sidebar">
      <div id="navcolumn">
              <h2>
          Groovy Sandbox
        </h2><ul>
              
    <li class="none">
              <strong>Introduction</strong>
        </li>
              
    <li class="none">
              <a href="https://github.com/jenkinsci/groovy-sandbox">Source code</a>
        </li>
              
    <li class="none">
              <a href="https://github.com/jenkinsci/groovy-sandbox/issues">Bugs</a>
        </li>
          </ul>
      <h2>
          References
        </h2><ul>
              
    <li class="none">
              <a href="apidocs/index.html">Javadoc</a>
        </li>
          </ul>
      <h2>
          Project Documentation
        </h2><ul>
              
                
              
      
            
      
            
      
            
      
            
            
            
      
            
      
            
      
            
      
            
      
            
      
              
            <li class="expanded">
              <a href="project-info.html">Project Information</a>
                <ul>
                  
    <li class="none">
              <a href="dependencies.html">Dependencies</a>
        </li>
                  
    <li class="none">
              <a href="dependency-convergence.html">Dependency Convergence</a>
        </li>
                  
    <li class="none">
              <a href="dependency-info.html">Dependency Information</a>
        </li>
                  
    <li class="none">
              <a href="distribution-management.html">Distribution Management</a>
        </li>
                  
    <li class="none">
              <strong>About</strong>
        </li>
                  
    <li class="none">
              <a href="license.html">Project License</a>
        </li>
                  
    <li class="none">
              <a href="plugin-management.html">Plugin Management</a>
        </li>
                  
    <li class="none">
              <a href="plugins.html">Project Plugins</a>
        </li>
                  
    <li class="none">
              <a href="team-list.html">Project Team</a>
        </li>
                  
    <li class="none">
              <a href="source-repository.html">Source Repository</a>
        </li>
                  
    <li class="none">
              <a href="project-summary.html">Project Summary</a>
        </li>
              </ul>
        </li>
              
                
              
      
            
      
              
        <li class="collapsed">
              <a href="project-reports.html">Project Reports</a>
              </li>
          </ul>
        </div>
    </div>
    <div id="content">
      <div id="contentBox">
        <p>This project defines a <a href="http://groovy.codehaus.org/">Groovy</a> <a href="http://groovy.codehaus.org/api/org/codehaus/groovy/control/customizers/CompilationCustomizer.html"><code>CompilationCustomizer</code></a>,
which allows a program to execute Groovy script in a restricted sandbox environment.
It is useful for applications that want to provide some degree of scriptability to users, without allowing them
to execute <code>System.exit(0)</code> or any other undesirable operations.</p>

<p>This compile-time transformation modifies untrusted Groovy script in such a way that every operation that
can cause interactions with the external world gets intercepted. This allows your code to examine and deny
executions. This inclueds every method call, object allocations, property/attribute access, array access, and so on.</p>

<p>See <a href="http://kohsuke.org/2012/04/27/groovy-secureastcustomizer-is-harmful/">my blog post</a> that got this project started.</p>

<h1>Example</h1>

<p>You have to add <code>SandboxTransformer</code> to your <code>CompilerConfiguration</code> first:</p>

<pre><code>def cc = new CompilerConfiguration()
cc.addCompilationCustomizers(new SandboxTransformer())
def binding = new Binding();
binding.robot = robot = new Robot();
sh = new GroovyShell(binding,cc)
</code></pre>

<p>Any script compiled via the resulting shell object will now be sandboxed.</p>

<p>When a sandboxed script executes, all the operations mentioned above will get intercepted.
To examine those calls and reject some of them, create your own implementation of <code>GroovyInterceptor</code>
and registers it to the thread before you start executing the script:</p>

<pre><code>def sandbox = new RobotSandbox()
sandbox.register()
try {
    sh.evaluate("robot.leftArm.move()")
} finally {
    sandbox.unregister()
}
</code></pre>

<p>See the <a href="https://github.com/jenkinsci/groovy-sandbox/tree/master/src/test/groovy/org/kohsuke/groovy/sandbox/robot">robot example</a>
for a complete example.</p>

<h1>Considerations</h1>

<h2>Interceptors are thread specific</h2>

<p>You can register multiple interceptors, but they are all local to a thread.
This allows multi-threaded applications to isolate execution properly, but it also means you cannot
let the sandbox script create threads, or else it'll escape the sandbox.</p>

<p>The easiest way to do this
is to ensure you prohibit the use of <code>Thread</code> as the receiver, and prevent the sandboxed script from
accessing <code>Executor</code>-like services that let closures executed on different threads.</p>

<h2>No blacklisting</h2>

<p>Unlikes a sandbox provided by Java <code>SecurityManager</code>, this sandboxing is only a skin deep.
In other words, even if you prohibit a script from executing an operation X, if an attacker finds another method Y
that calls into X, he can execute X.</p>

<p>This in practice means you have to whitelist what's OK, as opposed to blacklist things that are problematic,
because you'll never know all the static methods that are available to the script in the JVM!</p>

<h2>Reflection</h2>

<p>Access to reflection almost always need to be blocked, or else a script can escape a sandbox by invoking
arbitrary methods on arbitrary objects, or remove the interceptor that you have installed.</p>

<p>The easiest way to do this is to prohibit the use of <code>Class</code> as a receiver. If that is too strong a restriction,
you can prohibit the use of <code>java.lang.reflect.*</code> classes as a receiver, and reject <code>Class.newInstance(...)</code> calls.</p>

      </div>
    </div>
    <div id="footer">
      <div class="xright">&#169;  
          2017
    
          <a href="http://kohsuke.org/">Kohsuke Kawaguchi</a> and other contributors
          
  

  
  
  &nbsp;| Last Published: 2017-08-16
  &nbsp;| Version: 1.15
</div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    </div></div>
  </body>
</html>
